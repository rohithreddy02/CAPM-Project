sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/core/Fragment","sap/m/MessageToast","sap/m/MessageBox","sap/f/library","sap/ui/core/format/DateFormat","sap/ui/core/date/UI5Date"],function(e,t,r,a,o,i,n,s){"use strict";return e.extend("ui5.controller.order",{onInit:function(){var e=sap.ui.core.UIComponent.getRouterFor(this);e.getRoute("order").attachPatternMatched(this._onRouteMatched,this);var r=new t({ID:"",Date:null,Customer_ID:"",headerText:"Customer"});this.getView().setModel(r,"newOrder")},_onRouteMatched:function(e){this._customerId=e.getParameter("arguments").customerId;this._customerName=e.getParameter("arguments").customerName;var t=this.getView().getModel("newOrder");t.setProperty("/headerText",this._customerName);var r=this.getView().getParent().getParent();r.setLayout(sap.f.LayoutType.OneColumn);var a=this.byId("orderTable");var o=a.getBinding("items");if(o){var i=new sap.ui.model.Filter("customer_ID","EQ",this._customerId);var n=new sap.ui.model.Sorter("date",true);o.filter([i]);o.sort([n])}},onCreateOrder:function(){var e=this.getView();if(!this._oCreateOrderDialog){r.load({id:e.getId(),name:"ui5.view.fragments.createOrder",controller:this}).then(function(t){e.addDependent(t);this._oCreateOrderDialog=t;this._oCreateOrderDialog.open()}.bind(this))}else{this._oCreateOrderDialog.open()}},validateOrderInputs:function(e,t){var r=true;if(!e.product||e.product.trim()===""){e.ProductValueState="Error";e.ProductValueStateText="Product name cannot be empty.";r=false}else{e.ProductValueState="None";e.ProductValueStateText=""}if(e.quantity===undefined||e.quantity===null||isNaN(e.quantity)||e.quantity<=0){e.QuantityValueState="Error";e.QuantityValueStateText="Enter a valid quantity greater than 0.";r=false}else{e.QuantityValueState="None";e.QuantityValueStateText=""}if(e.price===undefined||e.price===null||isNaN(e.price)||e.price<=0){e.PriceValueState="Error";e.PriceValueStateText="Enter a valid price greater than 0.";r=false}else{e.PriceValueState="None";e.PriceValueStateText=""}t.setData(e);return r},onAddItem:function(){var e=this.getView().getModel("newOrder");var t=e.getData();if(!this.validateOrderInputs(t,e)){return a.show("Failed to add item.")}if(!t.OrderItems){t.OrderItems=[]}var r={product:t.product,quantity:t.quantity,price:t.price};t.OrderItems.push(r);t.product="";t.quantity="";t.price="";t.ProductValueState="None";t.ProductValueStateText="";t.QuantityValueState="None";t.QuantityValueStateText="";t.PriceValueState="None";t.PriceValueStateText="";e.setData(t)},onDeleteItem:function(e){var t=this.getView().getModel("newOrder");var r=t.getData();var i=e.getSource();var n=i.getBindingContext("newOrder").getPath();var s=n.split("/").pop();o.confirm("Are you sure you want to delete this item?",{title:"Delete Item",onClose:function(e){if(e===o.Action.OK){r.OrderItems.splice(s,1);t.setData(r);a.show("Item deleted successfully")}}})},onSaveOrder:function(){var e=this.getView().getModel();var t=this.getView().getModel("newOrder");var r=t.getData();if(r.product||r.quantity||r.price){if(!this.validateOrderInputs(r,t)){return a.show("Please correct the errors before saving.")}if(!r.OrderItems){r.OrderItems=[]}var o={product:r.product,quantity:r.quantity,price:r.price};r.OrderItems.push(o);r.product="";r.quantity="";r.price="";r.ProductValueState="None";r.ProductValueStateText="";r.QuantityValueState="None";r.QuantityValueStateText="";r.PriceValueState="None";r.PriceValueStateText="";t.setData(r)}var i={date:new Date,customer_ID:this._customerId,orderItem:r.OrderItems};var n=this;e.create("/Order",i,{urlParameters:{$expand:"orderItem"},success:function(){a.show("Order created successfully");t.setData({product:"",quantity:"",price:"",OrderItems:[]});n._oCreateOrderDialog.close()},error:function(e){a.show("Error while creating order");console.error(e)}})},onCancelOrder:function(){var e=this.getView().getModel("newOrder");var t=e.getData();e.setData({...t,product:"",quantity:"",price:"",OrderItems:[]});this._oCreateOrderDialog.close()},onDeleteOrder:function(e){const t=e.getParameter("listItem");const r=t.getBindingContext();const a=this.getView().getModel();const o=a.getProperty(r.getPath()+"/ID");const i=`/Order/${o}`;sap.m.MessageBox.confirm(`Are you sure you want to delete Order ?`,{title:"Confirm Deletion",actions:[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],emphasizedAction:sap.m.MessageBox.Action.OK,onClose:function(e){if(e===sap.m.MessageBox.Action.OK){a.remove(i,{success:function(){sap.m.MessageToast.show("Order deleted successfully.")},error:function(){sap.m.MessageBox.error("Failed to delete the order.")}})}}})},onShowOrderItem:function(e){var t=e.getSource().getBindingContext();var r=t.getProperty("ID");var a=this.getView().getParent().getParent();a.setLayout(sap.f.LayoutType.TwoColumnsMidExpanded);this.getOwnerComponent().getRouter().navTo("orderItem",{customerId:this._customerId,customerName:this._customerName,orderId:r})},onNavBack:function(){var e=this.getView().getParent().getParent();e.setLayout(sap.f.LayoutType.OneColumn);var t=this.getOwnerComponent().getRouter();t.navTo("RouteadminDashboard")}})});
//# sourceMappingURL=order.controller.js.map