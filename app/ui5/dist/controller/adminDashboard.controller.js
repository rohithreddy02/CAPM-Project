sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/model/odata/v2/ODataModel","sap/m/MessageToast","sap/m/MessageBox","sap/ui/core/Fragment","sap/ui/model/FilterOperator","sap/f/library"],(e,t,a,o,r,n,s,i)=>{"use strict";return e.extend("ui5.controller.adminDashboard",{onRead:function(){var e=this.getOwnerComponent().getModel();e.read("/Customer",{success:function(e){var a=new t(e);this.getView().setModel(a,"Customer")}.bind(this),error:function(){o.show("Failed to fetch data")}})},onInit(){this.onRead();var e=new t({ID:"",Name:"",Email:"",ContactNumber:"",headerText:"Customers"});this.getView().setModel(e,"NewCustomer");this.updateCount()},updateCount:function(){var e=this.getView().getModel("NewCustomer");var t=this.getOwnerComponent().getModel();t.read("/Customer/$count",{success:function(t){console.log(t);e.setProperty("/headerText","Customers ("+t+")")},error:function(e){console.error("Failed to get Customer count",e)}})},onSearch:function(e){var t=e.getParameter("newValue");var a=this.byId("customerTable");var o=a.getBinding("items");if(t&&t.length>0){const e=["name","email","contactNumber"];const a=e.map(e=>new sap.ui.model.Filter({path:e,operator:s.Contains,value1:t,caseSensitive:false}));const r=new sap.ui.model.Filter(a,false);o.filter([r])}else{o.filter([])}},onCreate:function(){var e=this.getView();if(!this._oCreateCustomerDialog){n.load({id:e.getId(),name:"ui5.view.fragments.createCustomer",controller:this}).then(function(t){e.addDependent(t);this._oCreateCustomerDialog=t;this._oCreateCustomerDialog.open()}.bind(this))}else{this._oCreateCustomerDialog.open()}},onSave:function(){var e=this.getOwnerComponent().getModel();var t=this.getView().getModel("NewCustomer");var a=t.getData();var r=true;a.NameValueState="None";a.NameValueStateText="";a.EmailValueState="None";a.EmailValueStateText="";a.ContactNumberValueState="None";a.ContactNumberValueStateText="";if(!a.Name){a.NameValueState="Error";a.NameValueStateText="Name is required";r=false}var n=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(!a.Email){a.EmailValueState="Error";a.EmailValueStateText="Email is required";r=false}else if(!n.test(a.Email)){a.EmailValueState="Error";a.EmailValueStateText="Enter a valid Email";r=false}var s=/^\d{10}$/;if(!a.ContactNumber){a.ContactNumberValueState="Error";a.ContactNumberValueStateText="Contact Number is required";r=false}else if(!s.test(a.ContactNumber)){a.ContactNumberValueState="Error";a.ContactNumberValueStateText="Enter a valid 10-digit number";r=false}t.setData(a);if(!r){sap.m.MessageToast.show("Please fill in all required fields.");return}var i={name:a.Name,email:a.Email,contactNumber:a.ContactNumber};var l=this;e.create("/Customer",i,{success:function(){o.show("Customer created successfully!");t.setData({Name:"",NameValueState:"None",NameValueStateText:"",Email:"",EmailValueState:"None",EmailValueStateText:"",ContactNumber:"",ContactNumberValueState:"None",ContactNumberValueStateText:""});l.updateCount();l._oCreateCustomerDialog.close()},error:function(e){sap.m.MessageBox.error("Failed to create customer!",{title:"Error",onClose:function(){console.error(e)}})}})},onCancel:function(e){var t=this.getView().getModel("NewCustomer");t.setData({Name:"",NameValueState:"None",NameValueStateText:"",Company:"",CompanyValueState:"None",CompanyValueStateText:"",Email:"",EmailValueState:"None",EmailValueStateText:"",ContactNumber:"",ContactNumberValueState:"None",ContactNumberValueStateText:""});e.getSource().getParent().close()},onUpdate:function(){var e=this.getView().byId("customerTable");var t=e.getSelectedItem();if(!t){o.show("Please select an customer to update");return}var a=t.getBindingContext().getObject();console.log(a);var r=new sap.ui.model.json.JSONModel(a);console.log(r);this.getOwnerComponent().setModel(r,"NewUpdatedCustomer");var s=this.getView();if(!this._oUpdateDialog){n.load({id:s.getId(),name:"ui5.view.fragments.updateCustomer",controller:this}).then(function(e){s.addDependent(e);this._oUpdateDialog=e;this._oUpdateDialog.open()}.bind(this))}else{this._oUpdateDialog.open()}},onUpdateSave:function(){var e=this.getOwnerComponent().getModel();var t=this.getView().getModel("NewUpdatedCustomer");var a=t.getData();var r=true;a.NameValueState="None";a.NameValueStateText="";a.EmailValueState="None";a.EmailValueStateText="";a.ContactNumberValueState="None";a.ContactNumberValueStateText="";if(!a.name){a.NameValueState="Error";a.NameValueStateText="Name is required";r=false}var n=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(!a.email){a.EmailValueState="Error";a.EmailValueStateText="Email is required";r=false}else if(!n.test(a.email)){a.EmailValueState="Error";a.EmailValueStateText="Enter a valid Email";r=false}var s=/^\d{10}$/;if(!a.contactNumber){a.ContactNumberValueState="Error";a.ContactNumberValueStateText="Contact Number is required";r=false}else if(!s.test(a.contactNumber)){a.ContactNumberValueState="Error";a.ContactNumberValueStateText="Enter a valid 10-digit number";r=false}t.setData(a);if(!r){sap.m.MessageToast.show("Please fill in all required fields correctly.");return}if(!a.ID){sap.m.MessageToast.show("Missing Customer ID.");return}var i={name:a.name,email:a.email,contactNumber:a.contactNumber};var l="/Customer("+a.ID+")";var u=this;e.update(l,i,{success:function(){o.show("Customer updated successfully!");u.updateCount();t.setData({ID:"",name:"",NameValueState:"None",NameValueStateText:"",email:"",EmailValueState:"None",EmailValueStateText:"",contactNumber:"",ContactNumberValueState:"None",ContactNumberValueStateText:""});u._oUpdateDialog.close()},error:function(e){var t=e.responseText?JSON.parse(e.responseText):{};var a=t.error&&t.error.message&&t.error.message.value||"Failed to update customer.";sap.m.MessageBox.error(a,{title:"Update Failed",onClose:function(){console.error(e)}})}})},onUpdateCancel:function(){this._oUpdateDialog.close()},onDelete:function(){var e=this.getView().byId("customerTable");var t=e.getSelectedItem();if(!t){o.show("Please select an customer to delete.");return}var a=t.getBindingContext().getObject();var n=a.ID;var s="/Customer("+n+")";var i=this.getView().getModel();var l=this;r.confirm("Are you sure you want to delete customer ?",{actions:[r.Action.YES,r.Action.NO],onClose:function(e){if(e===r.Action.YES){i.remove(s,{success:function(){l.updateCount();o.show("Customer deleted successfully!")},error:function(e){r.error("Delete failed. Check console for details.");console.error("Delete Error:",e)}})}}})},onOrderView:function(e){var t=this.getOwnerComponent().getRouter();var a=e.getSource().getBindingContext();var o=a.getProperty("ID");var r=a.getProperty("name");var n=this.oView.getParent().getParent();n.setLayout(i.LayoutType.OneColumn);t.navTo("order",{customerId:o,customerName:r})}})});
//# sourceMappingURL=adminDashboard.controller.js.map